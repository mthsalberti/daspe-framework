class FilterBrowseControl{constructor(a,b,c){this.slug=a,this.dw_model_id=b,this.user_id=c,this.loadFilterBrowse(),this.listenToFilterBrowseButton()}listenToFilterBrowseButton(){let a=this;$("#modal-filter-ready").off("click").on("click",function(){}),$(".modal-filter").off("click").on("click",function(){$.ajax({type:"GET",url:"/admin/filter-control/get-options/"+a.slug,success:function(b){$("#modal-filter-field-choice").empty(),$("#modal-filter-field-choice").append(`
 <div>
 <select id="modal-filter-field-choice-select" class="mdb-select md-form colorful-select dropdown-primary">
 <option selected disabled>campos</option>
 </select>
 <label>Escolha um campo</label>
 </div>`);let c=$("#modal-filter-field-choice-select");$.each(b,function(a,b){c.append(`<option data-field-options='${JSON.stringify(b.options)}' data-field-type="${b.internalName}" value="${b.apiName}">${b.label}</option>`)}),listenToFormFieldsFuncionalities(),a.listenToFilterBrowseButton()},error:function(a){console.error(a)}}),a.loadFilterBrowse()}),$("#modal-filter-field-choice-select").off("change").on("change",function(){$("#modal-filter-field-choice-date-criteria-type").empty(),$("#modal-filter-field-choice-value").empty(),$("#modal-filter-field-choice-criteria").empty();let b=$("#modal-filter-field-choice-select option:selected").attr("data-field-type");-1<$.inArray(b,["id","text","email","cpf","cnpj","rg","cep","phone","belongsTo"])&&$("#modal-filter-field-choice-criteria").append(`
 <select id="modal-filter-field-choice-criteria-select" class="mdb-select md-form colorful-select dropdown-primary">
 <option selected disabled>critérios</option>
 <option value="=">igual</option>
 <option value="<>">não igual</option>
 <option value="like">contém</option>
 <option value="not like">não contém</option>
 <option value="starts with">começa com</option>
 <option value="ends with">termina com</option>
 </select>
 `),-1<$.inArray(b,["integer","money","number"])&&$("#modal-filter-field-choice-criteria").append(`
 <select id="modal-filter-field-choice-criteria-select" class="mdb-select md-form colorful-select dropdown-primary">
 <option selected disabled>critérios</option>
 <option value=">">maior</option>
 <option value=">=">maior ou igual</option>
 <option value="<">menor</option>
 <option value="<=">menor ou igual</option>
 <option value="=">igual</option>
 <option value="<>">diferente</option>
 </select>`),-1<$.inArray(b,["date","timestamp"])&&($("#modal-filter-field-choice-criteria").append(`
 <select id="modal-filter-field-choice-criteria-select" class="mdb-select md-form colorful-select dropdown-primary">
 <option selected disabled>critérios</option>
 <option value="=">igual</option>
 <option value=">">maior</option>
 <option value=">=">maior ou igual</option>
 <option value="<">menor</option>
 <option value="<=">menor ou igual</option>
 </select>`),$("#modal-filter-field-choice-date-criteria-type").append(`
 <select id="modal-filter-field-choice-date-criteria-type-value" class="mdb-select md-form colorful-select dropdown-primary">
 <option selected value="fixed">fixa</option>
 <option value="relative">relativa</option>
 </select>
 `)),-1<$.inArray(b,["selectdropdown","checkbox"])&&$("#modal-filter-field-choice-criteria").append(`
 <select id="modal-filter-field-choice-criteria-select" class="mdb-select md-form colorful-select dropdown-primary">
 <option selected disabled>critérios</option>
 <option value="=">igual</option>
 <option value="<>">diferente</option>
 </select>
 <label>Escolha um campo</label>
 `),listenToFormFieldsFuncionalities(),a.listenToFilterBrowseButton()}),$("#modal-filter-field-choice-criteria-select").off("change").on("change",function(){let b=$("#modal-filter-field-choice-select option:selected").attr("data-field-type");$("#modal-filter-field-choice-value").empty(),-1<$.inArray(b,["checkbox"])?a.appendFilterForcheckboxValue():-1<$.inArray(b,["selectdropdown"])?a.appendFilterForSelectValue():-1<$.inArray(b,["date","timestamp"])?(a.appendFilterForDateValue(),listenToFormFieldsFuncionalities()):a.appendFilterAnyValue(),a.listenToFilterBrowseButton()}),$("#modal-filter-field-choice-date-criteria-type-value").off("change").on("change",function(){a.appendFilterForDateValue(),listenToFormFieldsFuncionalities()}),$("#modal-filter-save").off("click").on("click",function(){let b=$("#modal-filter-save").text();if("confirmar"==b){let b=new SpinnerController;$.ajax({url:"/admin/api/list_views/raw",headers:{"X-CSRF-TOKEN":$("meta[name=\"csrf-token\"]").attr("content")},method:"post",data:{name:$("#new-view-list-name").val(),is_only_for_me:$("[id=only-for-this-list-view]:checked").length,user_id:a.user_id,dw_model_id:a.dw_model_id},error:function(){toastr.error("Algo deu errado. :( "),b.disable()},success:function(b){let c=JSON.parse(localStorage.getItem("filter-"+a.slug)),d=new SpinnerController;$.each(c,function(a,c){$.ajax({url:"/admin/api/list_view_criterias/raw",headers:{"X-CSRF-TOKEN":$("meta[name=\"csrf-token\"]").attr("content")},method:"post",data:{list_view_id:b.id,field_type:c.fieldType,field_api:c.fieldApi,field_label:c.criteriaLabel,criteria_api:c.criteriaApi,criteria_label:c.criteriaLabel,value:c.value,value_api:"undefined"==c.valueApi?c.value:c.valueApi},success:function(){history.replaceState({},{},updateQueryStringParameter(location.href,"view_id",b.id)),location.reload()},error:function(){toastr.error("Algo deu errado. :( "),d.disable()}})}),localStorage.setItem("filter-"+a.slug,[])}})}else{$("#modal-filter").find(".modal-body").append("\n <div class=\"bottom md-form w-100 white\" >\n <input type=\"text\" id=\"new-view-list-name\" class=\"form-control\">\n <label for=\"new-view-list-name\" class=\"\">Digite o nome aqui...</label>\n </div>\n <div class=\"form-check pl-0\">\n <input type=\"checkbox\" class=\"form-check-input\" id=\"only-for-this-list-view\" value=\"1\">\n <label class=\"form-check-label\" for=\"only-for-this-list-view\">Somente para mim</label>\n </div>"),$("#new-view-list-name").focus(),$("#modal-filter-save").text("confirmar")}}),$("#modal-filter-apply").off("click").on("click",function(){let b=$("#modal-filter-field-choice-select option:selected").attr("data-field-type"),c=$("[name=\"modal-filter-field-choice-value-input\"]:checked").val(),d=c;"checkbox"===b&&(c="0"==d?"falso":"verdadeiro"),c==null&&(c=$("[name=\"modal-filter-field-choice-value-input\"]").val()),d==null&&(d=c),a.appendFilterBrowse({fieldType:b,fieldLabel:$("#modal-filter-field-choice-select option:selected").text(),fieldApi:$("#modal-filter-field-choice-select option:selected").attr("value"),criteriaLabel:$("#modal-filter-field-choice-criteria-select option:selected").text(),criteriaApi:$("#modal-filter-field-choice-criteria-select option:selected").attr("value"),value:c,valueApi:d}),a.saveFilterLocalStorage(),a.listenToFilterBrowseButton()}),$(".delete-modal-filter-item").on("click",function(){$(this).closest("li").remove(),a.saveFilterLocalStorage()})}appendFilterBrowse(a){$("#modal-filter-already-set-fields ul").append(`
 <li class="list-group-item">
 <input type="hidden" name="temporary-filter-field-type[]" value="${a.fieldType}"/>
 <input type="hidden" name="temporary-filter-field-label[]" value="${a.fieldLabel}"/>
 <input type="hidden" name="temporary-filter-field-apiName[]" value="${a.fieldApi}"/>
 <input type="hidden" name="temporary-filter-criteria-label[]" value="${a.criteriaLabel}"/>
 <input type="hidden" name="temporary-filter-criteria-apiName[]" value="${a.criteriaApi}"/>
 <input type="hidden" name="temporary-filter-value[]" value="${a.value}"/>
 <input type="hidden" name="temporary-filter-valueApi[]" value="${a.valueApi}"/>
 <span class="filter-item-field">${a.fieldLabel}</span>
 <span class="filter-item-criteria">${a.criteriaLabel}</span>
 <span class="filter-item-value">
 ${a.value}</span>
 <span class="float-right delete-modal-filter-item position-absolute" style="top: 13px; right: 9px"><i class="far fa-times-circle red-text"></i></span>
 </li>
 `)}appendFilterAnyValue(){$("#modal-filter-field-choice-value").append(`
 <div class="md-form mb-2">
 <input type="text" id="modal-filter-field-choice-value-input"
 name="modal-filter-field-choice-value-input"
 autocomplete="off"
 class="form-control">
 <label for="modal-filter-field-choice-value-input">Valor para filtrar</label>
 </div>
 `)}appendFilterForcheckboxValue(){$("#modal-filter-field-choice-value").append(`
 <div class="form-check form-check-inline">
 <input type="radio" id="modal-filter-field-choice-value-input1"
 class="form-check-input" value="1"
 name="modal-filter-field-choice-value-input" checked>
 <label class="form-check-label" for="modal-filter-field-choice-value-input1">Verdadeiro</label>
 </div>
 <div class="form-check form-check-inline">
 <input type="radio" id="modal-filter-field-choice-value-input2" class="form-check-input" value="0"
 name="modal-filter-field-choice-value-input" >
 <label class="form-check-label" for="modal-filter-field-choice-value-input2">Falso</label>
 </div>`)}appendFilterForSelectValue(){let a=JSON.parse($("#modal-filter-field-choice-select option:selected").attr("data-field-options"));$("#modal-filter-field-choice-value").append(`
 <select id="modal-filter-field-choice-value-select-options"
 name="modal-filter-field-choice-value-input"
 class="mdb-select md-form colorful-select dropdown-primary" multiple>
 <option selected disabled>opções</option>
 </select>
 `);let b=$("#modal-filter-field-choice-value-select-options");$.each(a,function(a,c){b.append(`<option value="${a}">${c}</option>`)}),listenToFormFieldsFuncionalities()}appendFilterForDateValue(){let a=$("#modal-filter-field-choice-select option:selected").attr("data-field-type"),b=$("#modal-filter-field-choice-date-criteria-type-value").val();$("#modal-filter-field-choice-value").empty(),$("#modal-filter-field-choice-value").append(`
 <div class="md-form mb-2"><input type="text" id="modal-filter-field-choice-value-input" name="modal-filter-field-choice-value-input" autocomplete="off" class="form-control ${"fixed"==b?"date"==a?"datepicker":"input-date-time":""}"><label for="modal-filter-field-choice-value-input">Digite a data</label>
 </div>`)}loadFilterBrowse(){let a=this,b=localStorage.getItem("filter-"+a.slug);if(null!=b&&""!=b){let c=JSON.parse(b);$("#modal-filter-already-set-fields ul").empty(),$.each(c,function(b,c){a.appendFilterBrowse(c)})}}saveFilterLocalStorage(){let a=this.slug,b=[],c=$("input[name=\"temporary-filter-field-type[]\"]"),d=$("input[name=\"temporary-filter-field-label[]\"]"),e=$("input[name=\"temporary-filter-field-apiName[]\"]"),f=$("input[name=\"temporary-filter-criteria-label[]\"]"),g=$("input[name=\"temporary-filter-criteria-apiName[]\"]"),h=$("input[name=\"temporary-filter-value[]\"]"),i=$("input[name=\"temporary-filter-valueApi[]\"]");d.each(function(a){b.push({fieldType:c.eq(a).val(),fieldLabel:d.eq(a).val(),fieldApi:e.eq(a).val(),criteriaLabel:f.eq(a).val(),criteriaApi:g.eq(a).val(),value:h.eq(a).val(),valueApi:i.eq(a).val()})}),localStorage.setItem("filter-"+a,JSON.stringify(b))}}
